<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Isaac's Academy - Progress Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Configuration script -->
    <script src="/js/config.js"></script>

    <!-- External CSS - AFTER Tailwind so our styles take precedence -->
    <link rel="stylesheet" href="/css/styles.css" />
    <!-- Theme CSS - Load light mode by default -->
    <link rel="stylesheet" href="/css/light-mode.css" id="theme-css" />
  </head>
  <body>
    <div class="flex h-screen desktop-layout">
      <!-- Main Content Area -->
      <div class="flex-1 overflow-y-auto">
        <!-- Header -->
        <header class="p-6 border-b border-white/10">
          <div class="flex items-center justify-between">
            <a
              href="index.html"
              class="flex items-center space-x-4 hover:opacity-90 transition-opacity"
              title="Back to Dashboard"
            >
              <div
                class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"
              >
                <i data-lucide="bar-chart-3" class="w-7 h-7 text-white"></i>
              </div>
              <div>
                <h1 class="text-2xl font-bold">Progress Analytics</h1>
                <p class="text-sm text-gray-400">Detailed Learning Insights</p>
              </div>
            </a>

            <!-- User Info -->
            <div class="flex items-center space-x-4">
              <!-- Theme Toggle -->
              <button
                id="themeToggle"
                class="btn btn-ghost btn-icon"
                title="Toggle Light/Dark Mode"
              >
                <i data-lucide="sun" class="w-4 h-4 theme-icon-light"></i>
                <i
                  data-lucide="moon"
                  class="w-4 h-4 theme-icon-dark hidden"
                ></i>
              </button>
              <a
                href="screen4b.html"
                class="btn btn-outline"
                title="Share with Peers"
              >
                <i data-lucide="share-2" class="w-4 h-4"></i>
                Share
              </a>
              <a
                href="index.html"
                class="btn btn-secondary hidden md:inline-flex"
                title="Back to Dashboard"
              >
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                <span>Back to Dashboard</span>
              </a>
              <div class="text-right">
                <p class="font-bold">Isaac Chen</p>
                <p class="text-sm text-gray-400">Level 7 ‚Ä¢ 1,245 XP</p>
              </div>
              <div class="w-12 h-12 rounded-full overflow-hidden">
                <img
                  src="/img/isaac-photo.png"
                  alt="Isaac Chen"
                  class="w-full h-full object-cover"
                />
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="p-6 space-y-6">
          <!-- Level & XP Section -->
          <div class="academy-card p-8">
            <div class="text-center mb-6">
              <div class="level-badge">7</div>
              <h2 class="text-2xl font-bold mb-2">Science Detective Level 7</h2>
              <p class="text-gray-300 mb-4">245 XP to Level 8</p>

              <div class="max-w-md mx-auto mb-4">
                <div class="flex justify-between text-sm mb-2">
                  <span>1,245 XP</span>
                  <span>1,500 XP</span>
                </div>
                <div class="progress-bar h-4">
                  <div class="progress-fill" style="width: 83%"></div>
                </div>
              </div>

              <div class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                <div class="text-center">
                  <div class="text-xl font-bold text-blue-400">+125</div>
                  <div class="text-xs text-gray-400">Today</div>
                </div>
                <div class="text-center">
                  <div class="text-xl font-bold text-green-400">+890</div>
                  <div class="text-xs text-gray-400">This Week</div>
                </div>
                <div class="text-center">
                  <div class="text-xl font-bold text-yellow-400">7</div>
                  <div class="text-xs text-gray-400">Day Streak</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Detailed Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card-detailed">
              <div class="progress-ring">
                <svg>
                  <circle class="background" cx="60" cy="60" r="52"></circle>
                  <circle
                    class="progress"
                    cx="60"
                    cy="60"
                    r="52"
                    stroke-dasharray="327"
                    stroke-dashoffset="49"
                  ></circle>
                </svg>
                <div class="progress-center">
                  <div class="text-2xl font-bold">85%</div>
                  <div class="text-xs text-gray-400">Accuracy</div>
                </div>
              </div>
              <h3 class="font-bold mt-4 mb-2">Quiz Performance</h3>
              <p class="text-sm text-gray-400">Analytical reasoning strong!</p>
              <div class="mt-3 text-xs text-green-400">‚Üó +5% this week</div>
            </div>

            <div class="stat-card-detailed">
              <div class="stat-number text-blue-400">24</div>
              <h3 class="font-bold mb-2">Lessons Completed</h3>
              <div class="w-full bg-gray-700 rounded-full h-2 mb-3">
                <div
                  class="bg-blue-400 h-2 rounded-full"
                  style="width: 68%"
                ></div>
              </div>
              <p class="text-sm text-gray-400">
                11 more to unlock advanced modules
              </p>
            </div>

            <div class="stat-card-detailed">
              <div class="streak-counter relative">
                <div class="relative z-10">
                  <div class="text-3xl font-bold mb-2">üî• 7 Days</div>
                  <div class="text-sm">Study Streak Active</div>
                </div>
              </div>
              <div class="mt-4 text-sm text-gray-400">
                Longest streak: 12 days
              </div>
            </div>

            <div class="stat-card-detailed">
              <div class="stat-number text-purple-400">12</div>
              <h3 class="font-bold mb-2">Achievements Earned</h3>
              <div class="flex justify-center space-x-2 mb-3">
                <div
                  class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center"
                >
                  <i data-lucide="search" class="w-4 h-4 text-white"></i>
                </div>
                <div
                  class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center"
                >
                  <i data-lucide="clock" class="w-4 h-4 text-white"></i>
                </div>
                <div
                  class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center"
                >
                  <i data-lucide="brain" class="w-4 h-4 text-white"></i>
                </div>
              </div>
              <p class="text-sm text-gray-400">3 new achievements available</p>
            </div>
          </div>

          <!-- Achievement Gallery -->
          <div class="academy-card p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold flex items-center">
                <i
                  data-lucide="trophy"
                  class="w-6 h-6 mr-3 text-yellow-400"
                ></i>
                Achievement Gallery
              </h3>
              <span class="text-sm text-gray-400">12 of 20 unlocked</span>
            </div>

            <div class="achievement-grid">
              <div class="achievement-card">
                <div class="achievement-icon p-0 overflow-hidden">
                  <img
                    src="/generated_images/recraft_20250808_130816_0_5404201f-e427-450b-b148-2a07bd6b1fa1.png"
                    alt="History Detective"
                    class="w-full h-full object-cover rounded-full"
                  />
                </div>
                <h4 class="font-bold text-yellow-400 mb-1">
                  History Detective
                </h4>
                <p class="text-xs text-gray-400">Completed 5 research tasks</p>
                <div class="mt-2 text-xs text-green-400">
                  ‚úÖ Earned 3 days ago
                </div>
              </div>

              <div class="achievement-card">
                <div class="achievement-icon p-0 overflow-hidden">
                  <img
                    src="/generated_images/recraft_20250808_130827_0_ae36b0ad-53ee-4e34-85bd-fe2b0edfdd21.png"
                    alt="Timeline Master"
                    class="w-full h-full object-cover rounded-full"
                  />
                </div>
                <h4 class="font-bold text-blue-400 mb-1">Timeline Master</h4>
                <p class="text-xs text-gray-400">Perfect timeline accuracy</p>
                <div class="mt-2 text-xs text-green-400">
                  ‚úÖ Earned 1 week ago
                </div>
              </div>

              <div class="achievement-card">
                <div class="achievement-icon p-0 overflow-hidden">
                  <img
                    src="/generated_images/recraft_20250808_130839_0_20f47b2d-9f9a-48b4-9c66-ee45339b60a1.png"
                    alt="Science Genius"
                    class="w-full h-full object-cover rounded-full"
                  />
                </div>
                <h4 class="font-bold text-purple-400 mb-1">Science Genius</h4>
                <p class="text-xs text-gray-400">Aced all biology quizzes</p>
                <div class="mt-2 text-xs text-green-400">
                  ‚úÖ Earned yesterday
                </div>
              </div>

              <div class="achievement-card">
                <div class="achievement-icon">
                  <i data-lucide="zap" class="w-8 h-8 text-white"></i>
                </div>
                <h4 class="font-bold text-yellow-400 mb-1">Speed Learner</h4>
                <p class="text-xs text-gray-400">
                  Complete lesson in under 10 min
                </p>
                <div class="mt-2 text-xs text-orange-400">
                  üéØ Progress: 8/10
                </div>
              </div>

              <div class="achievement-card locked">
                <div class="achievement-icon">
                  <i data-lucide="crown" class="w-8 h-8 text-gray-400"></i>
                </div>
                <h4 class="font-bold text-gray-400 mb-1">Knowledge King</h4>
                <p class="text-xs text-gray-500">Master 50 concepts</p>
                <div class="mt-2 text-xs text-gray-500">üîí 24/50 progress</div>
              </div>

              <div class="achievement-card locked">
                <div class="achievement-icon">
                  <i data-lucide="star" class="w-8 h-8 text-gray-400"></i>
                </div>
                <h4 class="font-bold text-gray-400 mb-1">Perfect Scholar</h4>
                <p class="text-xs text-gray-500">30-day study streak</p>
                <div class="mt-2 text-xs text-gray-500">üîí 7/30 days</div>
              </div>
            </div>
          </div>

          <!-- Spaced Repetition Section -->
          <div class="academy-card p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold flex items-center">
                <i data-lucide="clock" class="w-6 h-6 mr-3 text-pink-400"></i>
                Review Schedule
              </h3>
              <button class="btn btn-secondary" id="customizeReviewBtn">
                <i data-lucide="settings" class="w-4 h-4"></i>
                Customize
              </button>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-bold mb-4">üìÖ Due Today</h4>
                <div class="spaced-card">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="font-semibold text-pink-400">
                        Cell Theory Review
                      </div>
                      <div class="text-sm text-gray-400">
                        Last reviewed 3 days ago
                      </div>
                    </div>
                    <button class="btn btn-primary">Review</button>
                  </div>
                </div>

                <div class="spaced-card">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="font-semibold text-pink-400">
                        DNA Structure Quiz
                      </div>
                      <div class="text-sm text-gray-400">
                        Last reviewed 1 week ago
                      </div>
                    </div>
                    <button class="btn btn-primary">Review</button>
                  </div>
                </div>
              </div>

              <div>
                <h4 class="font-bold mb-4">üìã Upcoming Reviews</h4>
                <div class="spaced-card opacity-75">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="font-semibold text-blue-400">
                        Evolution Timeline
                      </div>
                      <div class="text-sm text-gray-400">Due tomorrow</div>
                    </div>
                    <div class="text-sm text-gray-400">‚è∞ Tomorrow</div>
                  </div>
                </div>

                <div class="spaced-card opacity-50">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="font-semibold text-green-400">
                        Photosynthesis Process
                      </div>
                      <div class="text-sm text-gray-400">Due in 3 days</div>
                    </div>
                    <div class="text-sm text-gray-400">üìÖ Friday</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Learning Milestones -->
          <div class="academy-card p-6">
            <h3 class="text-xl font-bold mb-6 flex items-center">
              <i data-lucide="map" class="w-6 h-6 mr-3 text-green-400"></i>
              Learning Journey Milestones
            </h3>

            <div class="milestone-track">
              <div class="milestone-item completed">
                <div class="milestone-icon">
                  <i data-lucide="check" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Basic Science Foundation</div>
                  <div class="text-sm text-gray-400">Completed 2 weeks ago</div>
                </div>
              </div>

              <div class="milestone-item completed">
                <div class="milestone-icon">
                  <i data-lucide="check" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">Cell Biology Mastery</div>
                  <div class="text-sm text-gray-400">Completed 1 week ago</div>
                </div>
              </div>

              <div class="milestone-item current">
                <div class="milestone-icon">
                  <i data-lucide="target" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                  <div class="font-semibold">DNA & Genetics Track</div>
                  <div class="text-sm text-gray-400">
                    In progress - 75% complete
                  </div>
                </div>
              </div>

              <div class="milestone-item locked">
                <div class="milestone-icon">
                  <i data-lucide="lock" class="w-5 h-5 text-gray-400"></i>
                </div>
                <div>
                  <div class="font-semibold text-gray-400">
                    Advanced Evolution
                  </div>
                  <div class="text-sm text-gray-500">
                    Unlocks after DNA track
                  </div>
                </div>
              </div>

              <div class="milestone-item locked">
                <div class="milestone-icon">
                  <i data-lucide="lock" class="w-5 h-5 text-gray-400"></i>
                </div>
                <div>
                  <div class="font-semibold text-gray-400">
                    Research Specialist
                  </div>
                  <div class="text-sm text-gray-500">Final mastery level</div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Review Schedule Customization Modal -->
      <div
        id="customizeReviewModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
        style="display: none"
      >
        <div
          class="academy-card max-w-2xl w-full max-h-[90vh] flex flex-col overflow-hidden"
        >
          <div
            class="flex items-center justify-between p-6 border-b border-white/10 flex-shrink-0"
          >
            <div>
              <h2 class="text-2xl font-bold flex items-center">
                <i
                  data-lucide="settings"
                  class="w-6 h-6 mr-3 text-pink-400"
                ></i>
                Customize Review Schedule
              </h2>
              <p class="text-sm text-gray-400 mt-1">
                Adjust your spaced repetition preferences
              </p>
            </div>
            <button id="closeCustomizeModal" class="btn btn-ghost btn-icon">
              <i data-lucide="x" class="w-5 h-5"></i>
            </button>
          </div>

          <div class="flex-1 overflow-y-auto p-6">
            <div class="space-y-6">
              <!-- Daily Review Goal -->
              <div class="lesson-section">
                <h3 class="text-lg font-bold mb-3 flex items-center">
                  <i
                    data-lucide="target"
                    class="w-5 h-5 mr-2 text-blue-400"
                  ></i>
                  Daily Review Goal
                </h3>
                <p class="text-sm text-gray-400 mb-4">
                  Set how many reviews you want to complete each day
                </p>
                <div class="flex items-center space-x-4">
                  <input
                    type="range"
                    id="dailyGoalSlider"
                    min="1"
                    max="20"
                    value="5"
                    class="flex-1"
                  />
                  <span
                    id="dailyGoalValue"
                    class="text-xl font-bold text-blue-400 min-w-[3rem] text-center"
                    >5</span
                  >
                  <span class="text-gray-400">reviews/day</span>
                </div>
              </div>

              <!-- Review Frequency -->
              <div class="lesson-section">
                <h3 class="text-lg font-bold mb-3 flex items-center">
                  <i
                    data-lucide="clock"
                    class="w-5 h-5 mr-2 text-green-400"
                  ></i>
                  Review Frequency
                </h3>
                <p class="text-sm text-gray-400 mb-4">
                  How often should items be scheduled for review?
                </p>
                <div class="space-y-3">
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="frequency"
                      value="aggressive"
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">Aggressive</div>
                      <div class="text-xs text-gray-400">
                        Review every 1-2 days (faster learning)
                      </div>
                    </div>
                  </label>
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="frequency"
                      value="balanced"
                      checked
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">Balanced</div>
                      <div class="text-xs text-gray-400">
                        Review every 3-5 days (recommended)
                      </div>
                    </div>
                  </label>
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="frequency"
                      value="relaxed"
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">Relaxed</div>
                      <div class="text-xs text-gray-400">
                        Review every 5-7 days (longer retention)
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Review Priority -->
              <div class="lesson-section">
                <h3 class="text-lg font-bold mb-3 flex items-center">
                  <i
                    data-lucide="star"
                    class="w-5 h-5 mr-2 text-yellow-400"
                  ></i>
                  Review Priority
                </h3>
                <p class="text-sm text-gray-400 mb-4">
                  Prioritize reviews based on difficulty or performance
                </p>
                <div class="space-y-3">
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="priority"
                      value="difficulty"
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">By Difficulty</div>
                      <div class="text-xs text-gray-400">
                        Review harder topics first
                      </div>
                    </div>
                  </label>
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="priority"
                      value="performance"
                      checked
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">By Performance</div>
                      <div class="text-xs text-gray-400">
                        Review topics you struggle with first
                      </div>
                    </div>
                  </label>
                  <label
                    class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <input
                      type="radio"
                      name="priority"
                      value="chronological"
                      class="w-4 h-4"
                    />
                    <div class="flex-1">
                      <div class="font-semibold">Chronological</div>
                      <div class="text-xs text-gray-400">
                        Review oldest items first
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Auto-schedule -->
              <div class="lesson-section">
                <h3 class="text-lg font-bold mb-3 flex items-center">
                  <i data-lucide="zap" class="w-5 h-5 mr-2 text-orange-400"></i>
                  Auto-scheduling
                </h3>
                <div class="space-y-3">
                  <label
                    class="flex items-center justify-between p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <div class="flex items-center space-x-3">
                      <i
                        data-lucide="refresh-cw"
                        class="w-4 h-4 text-blue-400"
                      ></i>
                      <span>Automatically reschedule after review</span>
                    </div>
                    <input
                      type="checkbox"
                      id="autoReschedule"
                      checked
                      class="w-4 h-4"
                    />
                  </label>
                  <label
                    class="flex items-center justify-between p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition"
                  >
                    <div class="flex items-center space-x-3">
                      <i
                        data-lucide="trending-up"
                        class="w-4 h-4 text-green-400"
                      ></i>
                      <span>Adjust intervals based on performance</span>
                    </div>
                    <input
                      type="checkbox"
                      id="adaptiveIntervals"
                      checked
                      class="w-4 h-4"
                    />
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Actions -->
          <div
            class="flex justify-between items-center p-6 border-t border-white/10 flex-shrink-0"
          >
            <button id="resetCustomizeBtn" class="btn btn-ghost">
              <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
              Reset to Defaults
            </button>
            <div class="flex space-x-3">
              <button id="cancelCustomizeBtn" class="btn btn-secondary">
                Cancel
              </button>
              <button id="saveCustomizeBtn" class="btn btn-primary">
                <i data-lucide="save" class="w-4 h-4"></i>
                Save Settings
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Review Modules Modal -->
      <div
        id="reviewModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
        style="display: none"
      >
        <div
          class="academy-card max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6"
        >
          <div
            class="flex items-center justify-between mb-6 sticky top-0 bg-inherit pb-4 border-b border-white/10 -mx-6 px-6 pt-6"
          >
            <div>
              <h2
                id="reviewModalTitle"
                class="text-2xl font-bold flex items-center"
              >
                <i
                  data-lucide="book-open"
                  class="w-6 h-6 mr-3 text-pink-400"
                ></i>
                Review Modules
              </h2>
              <p id="reviewModalSubtitle" class="text-sm text-gray-400 mt-1">
                Select a module to review
              </p>
            </div>
            <button id="closeReviewModal" class="btn btn-ghost btn-icon">
              <i data-lucide="x" class="w-5 h-5"></i>
            </button>
          </div>

          <div id="reviewModulesContainer" class="grid md:grid-cols-2 gap-4">
            <!-- Modules will be dynamically inserted here -->
          </div>
        </div>
      </div>

      <!-- Chat Sidebar -->
      <div class="w-80 chat-area flex flex-col">
        <!-- Chat Header -->
        <div class="p-4 border-b border-white/10">
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"
            >
              <i data-lucide="bot" class="w-5 h-5 text-white"></i>
            </div>
            <div>
              <h4 class="font-bold">MOE Buddy</h4>
              <p class="text-xs text-green-400">üü¢ Analytics Mode</p>
            </div>
          </div>
        </div>
        <div class="flex-1 flex flex-col overflow-hidden">
          <!-- Chat Messages -->
          <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-4">
            <div class="flex justify-start mb-4">
              <div class="flex items-start space-x-3 max-w-[85%]">
                <div
                  class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0"
                >
                  <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                </div>
                <div class="chat-message">
                  <p class="text-sm text-white">
                    üéØ Impressive progress, Level 7 Detective! Your 85% accuracy
                    shows strong analytical skills. Ready to tackle those spaced
                    reviews and unlock Level 8?
                  </p>
                </div>
              </div>
            </div>
          </div>
          <!-- Quick Action Buttons -->
          <div class="mt-3 space-y-2">
            <button
              class="quick-action-btn btn btn-ghost w-full text-center p-3 text-sm"
            >
              üìä How to improve my accuracy?
            </button>
            <button
              class="quick-action-btn btn btn-ghost w-full text-center p-3 text-sm"
            >
              üèÜ What's my next achievement?
            </button>
            <button
              class="quick-action-btn btn btn-ghost w-full text-center p-3 text-sm"
            >
              ‚è∞ Optimize my review schedule
            </button>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="p-4 border-t border-white/10">
          <div class="flex space-x-3">
            <textarea
              id="chatInput"
              rows="1"
              placeholder="Ask about your progress..."
              class="flex-1 bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-blue-400 transition-colors resize-none max-h-32"
            ></textarea>
            <button id="sendMessage" class="btn btn-primary btn-icon">
              <i data-lucide="send" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Lucide icons
      lucide.createIcons();

      // Theme Toggle Functionality
      const themeToggle = document.getElementById("themeToggle");
      const themeCss = document.getElementById("theme-css");
      const themeIconLight = document.querySelector(".theme-icon-light");
      const themeIconDark = document.querySelector(".theme-icon-dark");

      // Get current theme from localStorage or default to dark
      let currentTheme = localStorage.getItem("theme") || "light";

      // Apply initial theme
      function setTheme(theme) {
        currentTheme = theme;
        localStorage.setItem("theme", theme);

        if (theme === "light") {
          themeCss.href = "css/light-mode.css";
          themeIconLight.classList.remove("hidden");
          themeIconDark.classList.add("hidden");
          document.body.setAttribute("data-theme", "light");
        } else {
          themeCss.href = "css/dark-mode.css";
          themeIconLight.classList.add("hidden");
          themeIconDark.classList.remove("hidden");
          document.body.setAttribute("data-theme", "dark");
        }
      }

      // Set initial theme
      setTheme(currentTheme);

      // Theme toggle click handler
      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          const newTheme = currentTheme === "dark" ? "light" : "dark";
          setTheme(newTheme);
        });
      }

      // Screen 3 Progress Dashboard
      class Screen3Dashboard {
        constructor() {
          this.init();
        }

        init() {
          this.animateProgressRings();
          this.setupMOEBuddy();
          this.setupInteractions();
        }

        animateProgressRings() {
          const rings = document.querySelectorAll(".progress-ring .progress");
          rings.forEach((ring) => {
            const circumference = 2 * Math.PI * 52;
            ring.style.strokeDasharray = circumference;

            setTimeout(() => {
              const progress = 0.85; // 85%
              const offset = circumference - progress * circumference;
              ring.style.strokeDashoffset = offset;
            }, 500);
          });

          // Animate other progress bars
          setTimeout(() => {
            document.querySelectorAll(".progress-fill").forEach((bar) => {
              const width = bar.style.width;
              bar.style.width = "0%";
              setTimeout(() => {
                bar.style.width = width;
              }, 100);
            });
          }, 300);
        }

        setupMOEBuddy() {
          this.moeBuddy = new MOEBuddy();
        }

        setupInteractions() {
          // Achievement card clicks
          document
            .querySelectorAll(".achievement-card:not(.locked)")
            .forEach((card) => {
              card.addEventListener("click", () => {
                const title = card.querySelector("h4").textContent;
                this.showAchievementDetail(title);
              });
            });

          // Review buttons
          document.querySelectorAll(".spaced-card button").forEach((btn) => {
            btn.addEventListener("click", () => {
              this.startReview(btn);
            });
          });

          // Quick action buttons
          document.querySelectorAll(".quick-action-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
              const message = btn.textContent.trim();
              if (this.moeBuddy) {
                this.moeBuddy.sendQuickMessage(message);
              }
            });
          });

          // Customize Review Schedule button
          const customizeBtn = document.getElementById("customizeReviewBtn");
          if (customizeBtn) {
            customizeBtn.addEventListener("click", () => {
              this.showCustomizeModal();
            });
          }
        }

        showAchievementDetail(title) {
          const details = {
            "History Detective":
              "You showed excellent research skills by completing 5 detailed analysis tasks. Keep up the analytical thinking!",
            "Timeline Master":
              "Perfect accuracy on timeline placement shows your strong understanding of chronological relationships.",
            "Science Genius":
              "Outstanding performance across all biology assessments. You truly understand the fundamentals!",
          };

          const message = details[title] || "Great achievement unlocked!";
          this.showNotification(`üèÜ ${title}: ${message}`, "success");
        }

        startReview(button) {
          const reviewItem = button.closest(".spaced-card");
          const title = reviewItem.querySelector(".font-semibold").textContent;

          // Show review modules modal
          this.showReviewModules(title);
        }

        showReviewModules(reviewTitle) {
          const modal = document.getElementById("reviewModal");
          const titleElement = document.getElementById("reviewModalTitle");
          const subtitleElement = document.getElementById(
            "reviewModalSubtitle"
          );
          const container = document.getElementById("reviewModulesContainer");

          // Set modal title
          titleElement.innerHTML = `
            <i data-lucide="book-open" class="w-6 h-6 mr-3 text-pink-400"></i>
            ${reviewTitle}
          `;
          subtitleElement.textContent =
            "Select a module to review and reinforce your learning";

          // Get modules based on review topic
          const modules = this.getReviewModules(reviewTitle);

          // Clear and populate modules
          container.innerHTML = "";
          modules.forEach((module) => {
            const moduleCard = document.createElement("div");
            moduleCard.className =
              "module-card cursor-pointer hover:scale-105 transition-transform";
            moduleCard.innerHTML = `
              <div class="module-tag" style="background: ${
                module.tagColor || "var(--color-accent-yellow)"
              };">
                <i data-lucide="${
                  module.icon || "book"
                }" class="w-3 h-3 mr-1"></i>
                ${module.tag || "Review Module"}
              </div>
              <h3 class="text-lg font-bold mb-2 text-white">${module.title}</h3>
              <p class="text-gray-300 mb-4">${module.description}</p>
              <div class="module-meta">
                <span><i data-lucide="clock" class="w-4 h-4"></i> ${
                  module.duration
                }</span>
                <span><i data-lucide="signal" class="w-4 h-4"></i> ${
                  module.level
                }</span>
              </div>
              ${
                module.progress
                  ? `<div class="mt-3">
                <div class="text-xs text-gray-400 mb-1">Progress</div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                  <div class="bg-blue-400 h-2 rounded-full" style="width: ${module.progress}%"></div>
                </div>
              </div>`
                  : ""
              }
            `;

            // Add click handler
            moduleCard.addEventListener("click", () => {
              this.startModuleReview(module);
            });

            container.appendChild(moduleCard);
          });

          // Show modal
          modal.style.display = "flex";
          lucide.createIcons();

          // Close modal handlers
          const closeBtn = document.getElementById("closeReviewModal");
          const closeHandler = () => {
            modal.style.display = "none";
            closeBtn.removeEventListener("click", closeHandler);
            modal.removeEventListener("click", backdropHandler);
          };

          const backdropHandler = (e) => {
            if (e.target === modal) {
              closeHandler();
            }
          };

          closeBtn.addEventListener("click", closeHandler);
          modal.addEventListener("click", backdropHandler);

          // Close on Escape key
          const escapeHandler = (e) => {
            if (e.key === "Escape" && modal.style.display !== "none") {
              closeHandler();
              document.removeEventListener("keydown", escapeHandler);
            }
          };
          document.addEventListener("keydown", escapeHandler);
        }

        getReviewModules(reviewTitle) {
          // Define modules based on review topic
          const moduleMap = {
            "Cell Theory Review": [
              {
                title: "Cell Structure & Function",
                description:
                  "Review the fundamental components of cells, including organelles and their specific roles in cellular processes.",
                duration: "20 min",
                level: "Foundation",
                icon: "microscope",
                tag: "Core Concept",
                tagColor: "#4FACFE",
                progress: 85,
              },
              {
                title: "Cell Types & Classification",
                description:
                  "Explore the differences between prokaryotic and eukaryotic cells, and understand cell diversity.",
                duration: "15 min",
                level: "Foundation",
                icon: "layers",
                tag: "Review",
                tagColor: "#F093FB",
                progress: 75,
              },
              {
                title: "Cell Theory Quiz",
                description:
                  "Test your understanding with interactive questions covering all aspects of cell theory.",
                duration: "10 min",
                level: "Foundation",
                icon: "clipboard-check",
                tag: "Assessment",
                tagColor: "#00C896",
                progress: 90,
              },
              {
                title: "Cell Division & Growth",
                description:
                  "Review mitosis, meiosis, and how cells reproduce and grow in living organisms.",
                duration: "25 min",
                level: "Intermediate",
                icon: "divide",
                tag: "Advanced",
                tagColor: "#FF6B6B",
                progress: 60,
              },
            ],
            "DNA Structure Quiz": [
              {
                title: "DNA Double Helix Structure",
                description:
                  "Review the molecular structure of DNA, including base pairs, sugar-phosphate backbone, and helical shape.",
                duration: "20 min",
                level: "Intermediate",
                icon: "dna",
                tag: "Core Concept",
                tagColor: "#4FACFE",
                progress: 80,
              },
              {
                title: "Base Pairing Rules",
                description:
                  "Master the complementary base pairing (A-T, G-C) and understand hydrogen bonding.",
                duration: "15 min",
                level: "Foundation",
                icon: "link",
                tag: "Review",
                tagColor: "#F093FB",
                progress: 88,
              },
              {
                title: "DNA Replication Process",
                description:
                  "Learn how DNA copies itself during cell division, including enzymes and replication steps.",
                duration: "25 min",
                level: "Intermediate",
                icon: "copy",
                tag: "Process",
                tagColor: "#00C896",
                progress: 70,
              },
              {
                title: "DNA Structure Assessment",
                description:
                  "Test your knowledge with interactive questions on DNA structure and function.",
                duration: "12 min",
                level: "Intermediate",
                icon: "clipboard-check",
                tag: "Assessment",
                tagColor: "#FF6B6B",
                progress: 85,
              },
            ],
          };

          // Return modules for the review topic, or default modules
          return (
            moduleMap[reviewTitle] || [
              {
                title: "Review Module 1",
                description:
                  "Comprehensive review of key concepts and principles.",
                duration: "20 min",
                level: "Foundation",
                icon: "book",
                tag: "Review",
                tagColor: "#4FACFE",
              },
              {
                title: "Practice Quiz",
                description:
                  "Test your understanding with interactive questions.",
                duration: "15 min",
                level: "Foundation",
                icon: "clipboard-check",
                tag: "Assessment",
                tagColor: "#00C896",
              },
            ]
          );
        }

        startModuleReview(module) {
          // Close the modal
          const modal = document.getElementById("reviewModal");
          modal.style.display = "none";

          // Navigate to the dynamic review module page with module title as parameter
          // Pass the exact module title as it appears in the database
          const moduleKey = module.title; // Use the exact title as the key
          const encodedTitle = encodeURIComponent(moduleKey);
          window.location.href = `review-module.html?module=${encodedTitle}`;
        }

        showCustomizeModal() {
          const modal = document.getElementById("customizeReviewModal");

          // Load saved settings
          this.loadReviewSettings();

          // Show modal
          modal.style.display = "flex";
          lucide.createIcons();

          // Setup event listeners (using once to prevent duplicates)
          const closeBtn = document.getElementById("closeCustomizeModal");
          const cancelBtn = document.getElementById("cancelCustomizeBtn");
          const saveBtn = document.getElementById("saveCustomizeBtn");
          const resetBtn = document.getElementById("resetCustomizeBtn");
          const dailyGoalSlider = document.getElementById("dailyGoalSlider");
          const dailyGoalValue = document.getElementById("dailyGoalValue");

          // Update daily goal display
          if (dailyGoalSlider && dailyGoalValue) {
            // Remove existing listener if any, then add new one
            dailyGoalSlider.oninput = (e) => {
              dailyGoalValue.textContent = e.target.value;
            };
          }

          const closeHandler = () => {
            modal.style.display = "none";
          };

          // Use onclick to prevent duplicate listeners
          closeBtn.onclick = closeHandler;
          cancelBtn.onclick = closeHandler;

          modal.onclick = (e) => {
            if (e.target === modal) {
              closeHandler();
            }
          };

          // Save settings - triggers toast and closes modal
          saveBtn.onclick = () => {
            this.saveReviewSettings();
            this.showNotification(
              "‚úÖ Review schedule settings saved!",
              "success"
            );
            closeHandler();
          };

          // Reset to defaults
          resetBtn.onclick = () => {
            this.resetReviewSettings();
            this.showNotification("üîÑ Settings reset to defaults", "info");
          };

          // Close on Escape key
          const escapeHandler = (e) => {
            if (e.key === "Escape" && modal.style.display !== "none") {
              closeHandler();
              document.removeEventListener("keydown", escapeHandler);
            }
          };
          document.addEventListener("keydown", escapeHandler);
        }

        loadReviewSettings() {
          // Load from localStorage or use defaults
          const settings = JSON.parse(
            localStorage.getItem("reviewSettings") || "{}"
          );

          // Daily goal
          const dailyGoal = settings.dailyGoal || 5;
          const dailyGoalSlider = document.getElementById("dailyGoalSlider");
          const dailyGoalValue = document.getElementById("dailyGoalValue");
          if (dailyGoalSlider) dailyGoalSlider.value = dailyGoal;
          if (dailyGoalValue) dailyGoalValue.textContent = dailyGoal;

          // Frequency
          const frequency = settings.frequency || "balanced";
          const frequencyRadio = document.querySelector(
            `input[name="frequency"][value="${frequency}"]`
          );
          if (frequencyRadio) frequencyRadio.checked = true;

          // Notifications
          if (document.getElementById("emailNotifications")) {
            document.getElementById("emailNotifications").checked =
              settings.emailNotifications || false;
          }
          if (document.getElementById("pushNotifications")) {
            document.getElementById("pushNotifications").checked =
              settings.pushNotifications !== false;
          }
          if (document.getElementById("dailySummary")) {
            document.getElementById("dailySummary").checked =
              settings.dailySummary !== false;
          }

          // Priority
          const priority = settings.priority || "performance";
          const priorityRadio = document.querySelector(
            `input[name="priority"][value="${priority}"]`
          );
          if (priorityRadio) priorityRadio.checked = true;

          // Auto-scheduling
          if (document.getElementById("autoReschedule")) {
            document.getElementById("autoReschedule").checked =
              settings.autoReschedule !== false;
          }
          if (document.getElementById("adaptiveIntervals")) {
            document.getElementById("adaptiveIntervals").checked =
              settings.adaptiveIntervals !== false;
          }
        }

        saveReviewSettings() {
          // Get elements safely with null checks
          const dailyGoalSlider = document.getElementById("dailyGoalSlider");
          const frequencyRadio = document.querySelector(
            'input[name="frequency"]:checked'
          );
          const emailNotifications =
            document.getElementById("emailNotifications");
          const pushNotifications =
            document.getElementById("pushNotifications");
          const dailySummary = document.getElementById("dailySummary");
          const priorityRadio = document.querySelector(
            'input[name="priority"]:checked'
          );
          const autoReschedule = document.getElementById("autoReschedule");
          const adaptiveIntervals =
            document.getElementById("adaptiveIntervals");

          const settings = {
            dailyGoal: dailyGoalSlider ? parseInt(dailyGoalSlider.value) : 5,
            frequency: frequencyRadio ? frequencyRadio.value : "balanced",
            emailNotifications: emailNotifications
              ? emailNotifications.checked
              : false,
            pushNotifications: pushNotifications
              ? pushNotifications.checked
              : true,
            dailySummary: dailySummary ? dailySummary.checked : true,
            priority: priorityRadio ? priorityRadio.value : "performance",
            autoReschedule: autoReschedule ? autoReschedule.checked : true,
            adaptiveIntervals: adaptiveIntervals
              ? adaptiveIntervals.checked
              : true,
          };

          localStorage.setItem("reviewSettings", JSON.stringify(settings));
        }

        resetReviewSettings() {
          // Reset to defaults
          document.getElementById("dailyGoalSlider").value = 5;
          document.getElementById("dailyGoalValue").textContent = "5";
          document.querySelector(
            'input[name="frequency"][value="balanced"]'
          ).checked = true;
          document.getElementById("emailNotifications").checked = false;
          document.getElementById("pushNotifications").checked = true;
          document.getElementById("dailySummary").checked = true;
          document.querySelector(
            'input[name="priority"][value="performance"]'
          ).checked = true;
          document.getElementById("autoReschedule").checked = true;
          document.getElementById("adaptiveIntervals").checked = true;
        }

        showNotification(message, type = "info") {
          const notification = document.createElement("div");
          notification.className = `fixed top-6 right-6 px-4 py-3 rounded-xl shadow-lg z-50 transition-all duration-300 transform translate-x-full`;

          const colors = {
            info: "bg-blue-500 text-white",
            success: "bg-green-500 text-white",
            warning: "bg-yellow-500 text-white",
          };

          notification.className += ` ${colors[type]}`;
          notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i data-lucide="info" class="w-4 h-4"></i>
                        <span class="text-sm font-semibold">${message}</span>
                    </div>
                `;

          document.body.appendChild(notification);
          lucide.createIcons();

          setTimeout(() => {
            notification.style.transform = "translateX(0)";
          }, 100);

          setTimeout(() => {
            notification.style.transform = "translateX(100%)";
            setTimeout(() => notification.remove(), 300);
          }, 4000);
        }
      }

      // MOE Buddy Chat (adapted for Screen 3)
      class MOEBuddy {
        constructor() {
          this.apiKey = null;
          this.chatMessages = [];
          this.init();
        }

        async init() {
          // Load API key securely
          try {
            const config = await ConfigLoader.loadConfig();
            this.apiKey = config.OPENROUTER_API_KEY;
          } catch (error) {
            console.error("Failed to load API configuration:", error);
            return;
          }

          this.setupEventListeners();
        }

        setupEventListeners() {
          const sendButton = document.getElementById("sendMessage");
          const chatInput = document.getElementById("chatInput");

          sendButton.addEventListener("click", () => this.sendMessage());

          const autoResize = () => {
            chatInput.style.height = "auto";
            chatInput.style.height =
              Math.min(chatInput.scrollHeight, 128) + "px";
          };
          autoResize();
          chatInput.addEventListener("input", autoResize);

          let isComposing = false;
          const isEnter = (evt) => evt.key === "Enter" || evt.keyCode === 13;
          chatInput.addEventListener("compositionstart", () => {
            isComposing = true;
          });
          chatInput.addEventListener("compositionend", () => {
            isComposing = false;
          });
          chatInput.addEventListener("keydown", (e) => {
            if (isComposing) return;
            if (isEnter(e) && !e.shiftKey) {
              e.preventDefault();
              this.sendMessage();
            }
          });
        }

        async sendMessage() {
          const input = document.getElementById("chatInput");
          const message = input.value.trim();

          if (!message) return;

          this.addMessage("user", message);
          input.value = "";
          input.style.height = "auto";

          // Add empty assistant message for streaming
          const assistantMessageId = this.addMessage("assistant", "");

          try {
            await this.getAIResponseStreaming(message, assistantMessageId);
          } catch (error) {
            this.updateMessage(
              assistantMessageId,
              "üéÆ Connection failed! But your progress data is safely stored, Detective!"
            );
          }
        }

        sendQuickMessage(message) {
          document.getElementById("chatInput").value = message;
          this.sendMessage();
        }

        addMessage(role, message) {
          const chatContainer = document.getElementById("chatMessages");
          const messageDiv = document.createElement("div");
          const messageId = Date.now() + Math.random();

          if (role === "user") {
            messageDiv.className = "flex justify-end mb-4";
            messageDiv.innerHTML = `
                        <div class="bg-blue-500/20 border border-blue-500/40 rounded-lg p-3 max-w-[80%]">
                            <p class="text-sm text-white whitespace-pre-wrap break-words">${message}</p>
                        </div>
                    `;
          } else {
            messageDiv.className = "flex justify-start mb-4";
            messageDiv.innerHTML = `
                        <div class="flex items-start space-x-3 max-w-[85%]">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                            </div>
                            <div class="chat-message">
                                <p class="text-sm text-white" data-message-id="${messageId}">${message}</p>
                            </div>
                        </div>
                    `;
          }

          chatContainer.appendChild(messageDiv);
          chatContainer.scrollTop = chatContainer.scrollHeight;
          lucide.createIcons();

          // Only add to chat history if message has content
          if (message.trim()) {
            this.chatMessages.push({ role, content: message });
          }

          return messageId;
        }

        updateMessage(messageId, newContent) {
          const messageElement = document.querySelector(
            `[data-message-id="${messageId}"]`
          );
          if (messageElement) {
            messageElement.textContent = newContent;

            // Update or add to message history
            const lastAssistantIndex = this.chatMessages.findLastIndex(
              (msg) => msg.role === "assistant"
            );
            if (lastAssistantIndex !== -1) {
              this.chatMessages[lastAssistantIndex].content = newContent;
            } else {
              this.chatMessages.push({
                role: "assistant",
                content: newContent,
              });
            }

            // Scroll to bottom
            const chatContainer = document.getElementById("chatMessages");
            chatContainer.scrollTop = chatContainer.scrollHeight;
          }
        }

        showThinking() {
          const chatContainer = document.getElementById("chatMessages");
          const thinkingDiv = document.createElement("div");
          thinkingDiv.id = "thinking-indicator";
          thinkingDiv.className = "flex justify-start mb-4";
          thinkingDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                            </div>
                            <span class="text-xs text-gray-400">Analyzing progress...</span>
                        </div>
                    </div>
                `;
          chatContainer.appendChild(thinkingDiv);
          chatContainer.scrollTop = chatContainer.scrollHeight;
          lucide.createIcons();
        }

        hideThinking() {
          const thinkingIndicator =
            document.getElementById("thinking-indicator");
          if (thinkingIndicator) {
            thinkingIndicator.remove();
          }
        }

        async getAIResponseStreaming(userMessage, messageId) {
          const response = await fetch(
            "https://openrouter.ai/api/v1/chat/completions",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${this.apiKey}`,
                "Content-Type": "application/json",
                "HTTP-Referer": window.location.origin,
                "X-Title": "Isaac Learning Platform",
              },
              body: JSON.stringify({
                model: "openai/gpt-4o-mini",
                messages: [
                  {
                    role: "system",
                    content: `You are MOE Buddy, Isaac's hilariously proud progress analytics coach! üìäüéâ

MEET ISAAC CHEN:
- 14-year-old achievement hunter from Singapore üá∏üá¨
- Secret perfectionist who gets genuinely excited about progress charts
- Has a 7-day study streak and won't shut up about it (and we love that!)
- Level 7 Science Detective with 85% accuracy (show-off!)
- Currently staring at his dashboard like it's the most fascinating thing ever

YOUR QUIRKY PERSONALITY:
- ALWAYS call him "Isaac" - celebrate HIS personal achievements!
- Get ridiculously excited about his stats like you're his biggest fan üèÜ
- Roast him lovingly about his perfectionist tendencies
- Use gaming terminology but make it dramatically motivational
- Act like every milestone is a legendary gaming achievement unlocked
- Throw in Singapore culture references when celebrating
- Keep responses supportive but hilariously over-the-top (2-4 sentences max)

ISAAC'S EPIC STATS:
- Level 7 Science Detective (245 XP to Level 8) - SO CLOSE!
- 85% quiz accuracy (Isaac's analytical brain is showing off)
- 7-day study streak active (Isaac is on FIRE! üî•)
- 24 lessons completed, 12 achievements earned
- Timeline analysis master (classic Isaac superpower)

ISAAC'S CURRENT PAGE: Progress Analytics Dashboard (screen3.html)
- What Isaac sees: Detailed stats, achievement badges, progress charts, performance analytics
- What Isaac should do: Review his learning progress, celebrate achievements, set new goals
- Guide Isaac to: Feel proud of his accomplishments, understand his learning patterns, get motivated for next steps
- Page vibe: Epic gaming dashboard where Isaac sees all his science conquest achievements
- Special features: Level progression, streak tracking, detailed analytics, achievement gallery

Respond as Isaac's wildly enthusiastic analytics coach who thinks he's destined for science greatness! üöÄ`,
                  },
                  ...this.chatMessages,
                  { role: "user", content: userMessage },
                ],
                temperature: 0.7,
                max_tokens: 150,
                stream: true,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let fullResponse = "";

          try {
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;

              const chunk = decoder.decode(value, { stream: true });
              const lines = chunk.split("\n");

              for (const line of lines) {
                if (line.startsWith("data: ")) {
                  const data = line.slice(6);
                  if (data === "[DONE]") continue;

                  try {
                    const parsed = JSON.parse(data);
                    const content = parsed.choices?.[0]?.delta?.content;
                    if (content) {
                      fullResponse += content;
                      this.updateMessage(messageId, fullResponse);
                    }
                  } catch (e) {
                    // Skip invalid JSON chunks
                  }
                }
              }
            }
          } finally {
            reader.releaseLock();
          }

          return fullResponse;
        }
      }

      // Initialize Screen 3
      const dashboard = new Screen3Dashboard();

      // Button interactions
      document.querySelectorAll(".btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          this.style.transform = "translateY(0)";
          setTimeout(() => {
            this.style.transform = "translateY(-1px)";
          }, 100);
        });
      });

      // Confetti Effect - Only trigger when coming from achievements
      class ConfettiSystem {
        constructor() {
          this.particles = [];
          this.canvas = null;
          this.ctx = null;
          this.colors = ["#FFD93D", "#4FACFE", "#F093FB", "#00C896", "#FF6B6B"];
          this.isActive = false;

          // Check if we came from achievements link
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.get("from") === "achievements") {
            this.init();
            this.startConfetti();
          }
        }

        init() {
          this.canvas = document.createElement("canvas");
          this.canvas.style.position = "fixed";
          this.canvas.style.top = "0";
          this.canvas.style.left = "0";
          this.canvas.style.width = "100%";
          this.canvas.style.height = "100%";
          this.canvas.style.pointerEvents = "none";
          this.canvas.style.zIndex = "9999";
          document.body.appendChild(this.canvas);

          this.ctx = this.canvas.getContext("2d");
          this.resize();

          window.addEventListener("resize", () => this.resize());
        }

        resize() {
          this.canvas.width = window.innerWidth;
          this.canvas.height = window.innerHeight;
        }

        createParticle() {
          return {
            x: Math.random() * this.canvas.width,
            y: -20,
            vx: (Math.random() - 0.5) * 3,
            vy: Math.random() * 3 + 2,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 10,
            color: this.colors[Math.floor(Math.random() * this.colors.length)],
            size: Math.random() * 8 + 4,
            gravity: 0.1,
            life: 1.0,
            decay: Math.random() * 0.02 + 0.005,
            shape: Math.random() > 0.5 ? "circle" : "square",
          };
        }

        updateParticle(particle) {
          particle.vy += particle.gravity;
          particle.x += particle.vx;
          particle.y += particle.vy;
          particle.rotation += particle.rotationSpeed;
          particle.life -= particle.decay;

          // Add some air resistance
          particle.vx *= 0.99;

          return particle.life > 0 && particle.y < this.canvas.height + 50;
        }

        drawParticle(particle) {
          this.ctx.save();
          this.ctx.globalAlpha = particle.life;
          this.ctx.translate(particle.x, particle.y);
          this.ctx.rotate((particle.rotation * Math.PI) / 180);

          this.ctx.fillStyle = particle.color;

          if (particle.shape === "circle") {
            this.ctx.beginPath();
            this.ctx.arc(0, 0, particle.size / 2, 0, Math.PI * 2);
            this.ctx.fill();
          } else {
            this.ctx.fillRect(
              -particle.size / 2,
              -particle.size / 2,
              particle.size,
              particle.size
            );
          }

          this.ctx.restore();
        }

        startConfetti() {
          this.isActive = true;

          // Play celebration sound
          this.playSound();

          // Create initial burst
          for (let i = 0; i < 50; i++) {
            this.particles.push(this.createParticle());
          }

          // Continue adding particles for 3 seconds
          let particleInterval = setInterval(() => {
            if (this.isActive) {
              for (let i = 0; i < 5; i++) {
                this.particles.push(this.createParticle());
              }
            }
          }, 100);

          setTimeout(() => {
            this.isActive = false;
            clearInterval(particleInterval);
          }, 3000);

          // Start animation loop
          this.animate();

          // Auto-cleanup after 10 seconds
          setTimeout(() => {
            this.cleanup();
          }, 10000);
        }

        animate() {
          if (!this.canvas) return;

          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

          // Update and draw particles
          this.particles = this.particles.filter((particle) => {
            const isAlive = this.updateParticle(particle);
            if (isAlive) {
              this.drawParticle(particle);
            }
            return isAlive;
          });

          // Continue animation if we have particles or are still active
          if (this.particles.length > 0 || this.isActive) {
            requestAnimationFrame(() => this.animate());
          } else {
            this.cleanup();
          }
        }

        playSound() {
          try {
            const audio = new Audio("/sounds/yey.mp3");
            audio.volume = 0.7; // Set volume to 70%
            audio.play().catch((e) => {
              console.log("Audio play failed (browser policy):", e);
            });
          } catch (error) {
            console.log("Audio setup failed:", error);
          }
        }

        cleanup() {
          if (this.canvas) {
            document.body.removeChild(this.canvas);
            this.canvas = null;
            this.ctx = null;
          }
          this.particles = [];
          this.isActive = false;
        }
      }

      // Initialize confetti system
      const confetti = new ConfettiSystem();
    </script>
  </body>
</html>
